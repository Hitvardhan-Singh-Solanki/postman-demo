!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=9)}([function(e,t){e.exports=require("express")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.saltRounds=10,t.MONGO_URI="mongodb://hitvardhan:HXUlABphtG9OoMyN@cluster0-shard-00-00-zi6lx.mongodb.net:27017,cluster0-shard-00-01-zi6lx.mongodb.net:27017,cluster0-shard-00-02-zi6lx.mongodb.net:27017/test?ssl=true&replicaSet=Cluster0-shard-0&authSource=admin&retryWrites=true&w=majority",t.PORT=8080,t.ORIGIN="http://localhost:3000",t.SECRET="some-cystic-string-secret-name-should-not-come"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.userResponsObject=function(e){var t=e.email,r=e._id;return{email:t,image:e.image,_id:r}};var n=function(e){return e<10?"0"+e:e};t.startTime=function(){var e=new Date;return n(e.getHours())+":"+n(e.getMinutes())+":"+n(e.getSeconds())}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(r(4)),o=i(r(5)),u=r(1);function i(e){return e&&e.__esModule?e:{default:e}}var s=new(0,n.default.Schema)({email:{type:String,required:!0,unique:!0},password:{type:String,required:!0},image:{type:String}});s.pre("save",(function(e){if(this.isNew||this.isModified("password")){var t=this;o.default.hash(t.password,u.saltRounds,(function(r,n){r?e(r):(t.password=n,e())}))}else e()})),s.methods.isCorrectPassword=function(e,t){o.default.compare(e,this.password,(function(e,r){e?t(e):t(e,r)}))},t.default=n.default.model("User",s)},function(e,t){e.exports=require("mongoose")},function(e,t){e.exports=require("bcrypt")},function(e,t){e.exports=require("passport")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={ensureAuthenticated:function(e,t,r){if(e.isAuthenticated())return r();t.sendStatus(401)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.visitorsList=t.addVisitor=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=r(2);var u=[];t.addVisitor=function(e){var t=e.socketid,r=e.email,i=function(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}(e,["socketid","email"]);if(!(r=r.trim().toLowerCase()))return{error:"Email is required."};var s=u.findIndex((function(e){return e.email===r}));if(-1!==s)return u[s]=n({socketid:t,email:r},i,{time:""+(0,o.startTime)()}),u[s];var a=n({socketid:t,email:r},i,{time:""+(0,o.startTime)()});return a?(u.push(a),{user:a}):void 0};t.visitorsList=function(){return u}},function(e,t,r){"use strict";r(10);var n=O(r(0)),o=O(r(11)),u=O(r(12)),i=O(r(13)),s=O(r(14)),a=O(r(15)),c=O(r(18)),l=r(1),d=O(r(6)),f=O(r(19)),p=O(r(21)),v=O(r(26));function O(e){return e&&e.__esModule?e:{default:e}}var m={origin:l.ORIGIN,optionsSuccessStatus:200,credentials:!0},g={secret:l.SECRET,resave:!0,saveUninitialized:!0};(0,f.default)(d.default);var _=(0,n.default)(),h=(0,u.default)(g);_.use((0,i.default)(m)),_.use(o.default.json()),_.use(o.default.urlencoded({extended:!1})),_.use(h),_.use(d.default.initialize()),_.use(d.default.session()),_.use((0,s.default)()),_.use(v.default),_.use("/api",a.default),(0,p.default)(_,h).listen(l.PORT,c.default)},function(e,t){e.exports=require("babel-polyfill")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("express-session")},function(e,t){e.exports=require("cors")},function(e,t){e.exports=require("cookie-parser")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=s(r(16)),u=s(r(17)),i=s(r(7));function s(e){return e&&e.__esModule?e:{default:e}}var a=(0,n.Router)();a.use("/auth",o.default),a.use("/protected",i.default.ensureAuthenticated,u.default),t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=c(r(3)),u=c(r(6)),i=c(r(7)),s=r(2),a=r(8);function c(e){return e&&e.__esModule?e:{default:e}}var l=(0,n.Router)();l.route("/login").get((function(e,t){t.status(405).send("not allowed")})).post((function(e,t,r){u.default.authenticate("local",(function(n,o,u){return n?r(n):o?void e.logIn(o,(function(e){return e?r(e):t.status(200).send((0,s.userResponsObject)(o))})):t.status(404).json({error:"User not found"})}))(e,t,r)})),l.route("/signup").get((function(e,t){t.status(405).send("not allowed")})).post((function(e,t){var r=e.body,n=r.email,u=r.password;new o.default({email:n,password:u,image:"https://img.icons8.com/color/96/000000/circled-user-male-skin-type-4.png"}).save((function(e){e?t.status(500).json({message:"Error registering new user please try again.",err:e}):t.sendStatus(200)}))})),l.route("/logout").get((function(e,t,r){e.logOut(),t.sendStatus(200)})),l.route("/check-token").get(i.default.ensureAuthenticated,(function(e,t){t.status(200).json((0,s.userResponsObject)(e.user))})),l.route("/history").get(i.default.ensureAuthenticated,(function(e,t){t.status(200).json((0,a.visitorsList)())})),t.default=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(0,r(0).Router)();n.route("/test").get((function(e,t){t.status(200).send("in protected route")})),t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o=r(4),u=(n=o)&&n.__esModule?n:{default:n},i=r(1);t.default=function(){u.default.connect(i.MONGO_URI,{useNewUrlParser:!0,useUnifiedTopology:!0});var e=u.default.connection;e.on("error",console.error.bind(console,"connection error:")),e.once("open",(function(){console.log("App listening on PORT "+i.PORT)}))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(20),o=i(r(5)),u=i(r(3));function i(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){var t=new n.Strategy({usernameField:"email"},(function(e,t,r){u.default.findOne({email:e}).then((function(e){if(!e)return r(null,!1,{message:"That email is not registered"});o.default.compare(t,e.password,(function(t,n){if(t)throw t;return n?r(null,e):r(null,!1,{message:"Password incorrect"})}))})).catch((function(e){return console.log(e)}))}));e.use(t),e.serializeUser((function(e,t){t(null,e.id)})),e.deserializeUser((function(e,t){u.default.findById(e,(function(e,r){t(e,r)}))}))}},function(e,t){e.exports=require("passport-local")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=l(r(22)),u=l(r(23)),i=r(24),s=r(25),a=r(2),c=r(8);function l(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t){var r=u.default.createServer(e),l=(0,o.default)(r,{serveClient:!1});return l.use((function(e,r){t(e.request,{},r)})).on("connection",(function(e){console.log((0,i.blue)((0,a.startTime)()+" New client connected"),i.blue.underline.bold(e.id)),e.on("join",(function(t){e.join("MAIN_ROOM"),e.emit("joined",n({text:"Welcome to the club!"},t)),(0,s.addUser)(n({},t,{socketid:e.id})),e.broadcast.to("MAIN_ROOM").emit("USER_JOINED",{currentUser:t}),l.in("MAIN_ROOM").emit("ROOM_DATA",{users:(0,s.getAllActiveUsers)()})})),e.on("disconnect",(function(){console.log(i.red.bgWhite("client disconnected"),i.red.underline.bold(e.id));var t=(0,s.removeUser)(e.id);t&&(0,c.addVisitor)(t),l.to("MAIN_ROOM").emit("USER_LEFT",{user:t}),l.in("MAIN_ROOM").emit("ROOM_DATA",{users:(0,s.getAllActiveUsers)()})}))})),r}},function(e,t){e.exports=require("socket.io")},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("chalk")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};var o=[];t.addUser=function(e){var t=e.socketid,r=e.email,u=function(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}(e,["socketid","email"]);r=r.trim().toLowerCase();var i=o.find((function(e){return e.email===r}));if(!r)return{error:"Email is required."};if(i)return{error:"email is taken."};var s=n({socketid:t,email:r},u);return o.push(s),{user:s}};t.removeUser=function(e){var t=o.findIndex((function(t){return t.socketid===e}));if(-1!==t)return o.splice(t,1)[0]},t.getUser=function(e){return o.find((function(t){return t.socketid===e}))},t.getAllActiveUsers=function(){return o}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){t.header("Access-Control-Allow-Credentials",!0),t.header("Access-Control-Allow-Origin",e.headers.origin),t.header("Access-Control-Allow-Methods","GET,PUT,POST,DELETE,UPDATE,OPTIONS"),t.header("Access-Control-Allow-Headers","X-Requested-With, X-HTTP-Method-Override, Content-Type, Accept"),r()}}]);